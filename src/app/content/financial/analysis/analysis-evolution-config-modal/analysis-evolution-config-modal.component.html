<h1 mat-dialog-title class="mhq-modal-header">
  <mat-icon>search</mat-icon>Configurar gráfico
</h1>

<div mat-dialog-content class="mhq-modal-content-wrapper mhq-row" style="padding: 2vh 4.5vw 0.5vh;">

  <div style="height:5px">
    <mat-progress-bar *ngIf="analysisService.waitingForSQL" mode="indeterminate" color="accent">
    </mat-progress-bar>
  </div>

  <div style="height:calc(25% - 5px);display: flex;
  justify-content: flex-end;align-items:center;">


    <div>
      <button (click)="saveGraphSettings()" *ngIf="editingMode" mat-mini-fab color="primary"
        style="background-color:var(--mhq-waikiki-sucess);color:#000;margin:0 15px">
        <mat-icon>save</mat-icon>
      </button>
      <button (click)="exitingEditingMode()" *ngIf="editingMode" mat-mini-fab color="warn">
        <mat-icon>not_interested</mat-icon>
      </button>
      <button (click)="enteringEditingMode()" *ngIf="!editingMode" mat-mini-fab color="primary">
        <mat-icon>edit</mat-icon>
      </button>

    </div>
  </div>

  <div *ngIf="!editingMode && !analysisService.waitingForSQL">
    <div style="width:100%;display: flex;">
      <div style="width:calc(100% / 12 * 8)">{{evolution.title}}</div>
      <div style="width:calc(100% / 12 * 2)">{{evolution.year}}</div>
      <div style="width:calc(100% / 12 * 2)">{{evolution.duration}}</div>
    </div>

    <br>

    {{categoriesService.catTable["'"+evolution.cat+"'"].title}}<br><br>

    <span *ngFor="let subcat of evolution.subcats">
      {{categoriesService.subcatTable[subcat].title}}<br></span>
  </div>

  <div *ngIf="editingMode && !analysisService.waitingForSQL">
    <div style="width:100%;display: flex;">
      <div style="width:calc(100% / 12 * 8)">
        <mat-form-field appearance="fill">
          <mat-label>Título do gráfico</mat-label>
          <input matInput type="text" [formControl]="header.title">
        </mat-form-field>
      </div>
      <div style="width:calc(100% / 12 * 2)">
        <mat-form-field appearance="fill">
          <mat-label>Ano inicial</mat-label>
          <input matInput type="number" [formControl]="header.year">
        </mat-form-field>
      </div>
      <div style="width:calc(100% / 12 * 2)">
        <mat-form-field appearance="fill">
          <mat-label>Duração</mat-label>
          <input matInput type="number" [formControl]="header.duration">
        </mat-form-field>
      </div>
    </div>

    <br>


    <form class="mhq-cats-form" style="width: 100%;">
      <mat-form-field>
        <mat-label>Categoria</mat-label>
        <mat-select [formControl]="catControl" (selectionChange)="catChanged($event)">
          <mat-select-trigger>{{catControl.value !== -1 ? categoriesService.catTable['\''+catControl.value+'\''].title :
            ''}}
          </mat-select-trigger>
          <mat-option *ngFor="let option of analysisService.catArray" [value]="option.id">
            <mat-icon
              [ngStyle]="{'background-color':categoriesService.catTable['\''+option.id+'\''].bgcolor,'color':categoriesService.catTable['\''+option.id+'\''].textcolor}">
              {{categoriesService.catTable['\''+option.id+'\''].icon}}</mat-icon>
            {{option.title}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </form>




    <div *ngFor="let subcat of evolution.subcats; let i = index">

      <form class="mhq-subcats-form" style="width: 100%;">
        <mat-form-field>
          <mat-label>Sub categoria</mat-label>
          <mat-select [formControl]="subcatControls[i]">
            <mat-option class="mhq-subcat-select" *ngFor="let subcatz of analysisService.subcategoriesList"
              [value]="subcatz.value">{{subcatz.title}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </form>







    </div>
  </div>

  <div mat-dialog-actions class="mhq-modal-close-actions"></div>